<!-- history.wxml -->
<view class="page-container">
  <!-- 筛选区域 -->
  <view class="filter-area">
    <view class="filter-options">
      <picker mode="date" value="{{selectedDate}}" bindchange="onDateChange">
        <view class="filter-item">
          <text>日期: {{selectedDate || '全部'}}</text>
          <text class="filter-arrow">▼</text>
        </view>
      </picker>
      <picker mode="selector" range="{{alarmTypes}}" range-key="name" value="{{selectedTypeIndex}}" bindchange="onTypeChange">
        <view class="filter-item">
          <text>类型: {{selectedTypeName || '全部'}}</text>
          <text class="filter-arrow">▼</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- 告警列表 -->
  <view class="alarm-list">
    <block wx:if="{{filteredAlarms.length > 0}}">
      <view class="alarm-item" wx:for="{{filteredAlarms}}" wx:key="id" bindtap="showAlarmDetail" data-index="{{index}}">
        <view class="alarm-content">
          <view class="alarm-type">{{item.type}}</view>
          <view class="alarm-time">{{item.time}}</view>
        </view>
      </view>
    </block>
    <view class="empty-tip" wx:else>
      <text>暂无符合条件的告警记录</text>
    </view>
  </view>

  <!-- 加载更多 -->
  <view class="load-more" wx:if="{{filteredAlarms.length > 0 && hasMoreData}}">
    <button class="load-more-btn" bindtap="loadMoreAlarms" loading="{{isLoading}}">加载更多</button>
  </view>

  <!-- 告警详情弹窗 -->
  <view class="alarm-detail-modal" wx:if="{{showDetailModal}}">
    <view class="modal-mask" bindtap="hideAlarmDetail"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">告警详情</text>
        <text class="modal-close" bindtap="hideAlarmDetail">×</text>
      </view>
      <view class="modal-body">
        <view class="detail-item">
          <text class="detail-label">告警类型：</text>
          <text>{{currentAlarm.type}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">告警时间：</text>
          <text>{{currentAlarm.time}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">告警描述：</text>
          <text>{{currentAlarm.description}}</text>
        </view>
      </view>
    </view>
  </view>
</view> 