<!-- map.wxml -->
<view class="container" bindtouchstart="touchStart" bindtouchmove="touchMove" bindtouchend="touchEnd">
  <!-- åœ°å›¾å®¹å™¨ï¼Œåº”ç”¨å˜æ¢ -->
  <view class="map-viewport" 
        style="transform: translate({{mapTransform.translateX}}px, {{mapTransform.translateY}}px) scale({{mapTransform.scale}}); transition: {{isManualControl ? 'none' : 'transform 0.3s ease-out'}};">
    
    <!-- åœ°å›¾èƒŒæ™¯ -->
    <view class="map-background">
      <image src="/images/map.jpg" mode="aspectFill" class="map-image"></image>
    </view>
    
    <!-- æœºå™¨äººä½ç½®æ ‡è®° -->
    <view class="robot-marker" style="left: {{robotPosition.x}}px; top: {{robotPosition.y}}px;">
      <image src="/images/robot.png" mode="aspectFit"></image>
      <!-- æœºå™¨äººå‘¨å›´çš„è§†é‡åœˆ -->
      <view class="robot-vision-circle"></view>
    </view>

    <!-- å‘Šè­¦ä¿¡æ¯æ ‡è®° -->
    <block wx:for="{{alerts}}" wx:key="id">
      <view wx:if="{{item.visible}}"
            class="alarm-marker" 
            style="left: {{item.x}}px; top: {{item.y}}px;">
        <!-- å‘Šè­¦åŠ¨ç”»å›¾æ ‡ -->
        <view class="alarm-icon">
          <view class="alarm-outer-ring" style="border-color: {{item.color}}"></view>
          <view class="alarm-middle-ring" style="border-color: {{item.color}}"></view>
          <view class="alarm-inner-circle" style="background-color: {{item.color}}"></view>
        </view>
        <!-- å‘Šè­¦ç±»å‹æ ‡ç­¾ -->
        <view class="alarm-tag">
          <view class="alarm-tag-dot" style="background-color: {{item.color}}"></view>
          <text>{{item.type}}</text>
        </view>
      </view>
    </block>
  </view>

  <!-- åœ°å›¾æ§åˆ¶å·¥å…·æ  -->
  <view class="map-controls">
    <view class="control-item" catchtap="zoomIn">
      <text class="control-icon">+</text>
    </view>
    <view class="control-item" catchtap="zoomOut">
      <text class="control-icon">-</text>
    </view>
    <view class="control-item" catchtap="resetMap">
      <text class="control-icon">â†º</text>
    </view>
    <view class="control-item {{followMode ? 'active' : ''}}" catchtap="toggleFollowMode">
      <text class="control-icon">ğŸ¯</text>
    </view>
  </view>

  <!-- è·Ÿéšæ¨¡å¼çŠ¶æ€æŒ‡ç¤ºå™¨ -->
  <view class="follow-status {{followMode ? 'auto' : 'disabled'}}">
    <text>{{followMode ? 'è·Ÿéšæ¨¡å¼' : 'æ­£å¸¸è§†è§’'}}</text>
  </view>

  <!-- è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ -->
  <view class="connection-status {{connected ? 'connected' : 'disconnected'}}">
    <text>{{connected ? 'å·²è¿æ¥' : 'æœªè¿æ¥'}}</text>
  </view>


</view> 